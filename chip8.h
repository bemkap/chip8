#pragma once

#include<time.h>
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<SDL2/SDL.h>

typedef unsigned char byte;
typedef unsigned short word;

struct CHIP8 {
  byte DT,ST,SP,MEM[4096],SCR[32][8],V[16],W,DF;
  word I,PC,KB,STK[16];
};

char MAP[256]={
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
   3,-1,-1,-1,-1,-1,-1, 0, 1, 2,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1, 5,-1,-1,-1, 4, 6,-1,-1,-1, 7,12,10,-1,
  -1,-1, 8,11, 9,-1,14,13,-1,-1,15,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
};

byte charset[5*16]={
  0xf0,0x90,0x90,0x90,0xf0,  0x20,0x60,0x20,0x20,0x70,  0xf0,0x10,0xf0,0x80,0xf0,  0xf0,0x10,0xf0,0x10,0xf0,
  0x90,0x90,0xf0,0x10,0x10,  0xf0,0x80,0xf0,0x10,0xf0,  0xf0,0x80,0xf0,0x90,0xf0,  0xf0,0x10,0x20,0x40,0x40,
  0xf0,0x90,0xf0,0x90,0xf0,  0xf0,0x90,0xf0,0x10,0xf0,  0xf0,0x90,0xf0,0x90,0x90,  0xe0,0x90,0xe0,0x90,0xe0,
  0xf0,0x80,0x80,0x80,0xf0,  0xe0,0x90,0x90,0x90,0xe0,  0xf0,0x80,0xf0,0x80,0xf0,  0xf0,0x80,0xf0,0x80,0x80
};

typedef void(*inst)(struct CHIP8*,word);

#define G(id) void id(struct CHIP8*M,word oc)

#define F(id,body) void id(struct CHIP8*M,word oc){        \
    byte x=oc>>8&0xf,y=oc>>4&0xf,n=oc&0xf,kk=oc&0xff;	   \
    word nnn=oc&0xfff;					   \
    do{body;}while(0);                                     \
  }
